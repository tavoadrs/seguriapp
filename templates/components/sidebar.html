<aside id="sidebar" class="fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white shadow-lg overflow-y-auto z-40">
    <nav class="p-4 space-y-2" id="sidebar-menu">
        <!-- Skeleton loading mientras carga -->
        <div class="animate-pulse space-y-2">
            <div class="h-12 bg-gray-200 rounded-lg"></div>
            <div class="h-12 bg-gray-200 rounded-lg"></div>
            <div class="h-12 bg-gray-200 rounded-lg"></div>
        </div>
    </nav>
    <div class="absolute bottom-0 left-0 w-full p-2 border-t border-gray-200">
        <button id="sidebar-toggle" class="flex items-center justify-center w-full px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition">
            <svg id="toggle-icon" class="w-5 h-5 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>
            </svg>
            <span id="toggle-text" class="ml-3 font-medium transition-opacity duration-150">Minimizar</span>
        </button>
    </div>
</aside>
<main id="main-content" class="ml-64 p-8 transition-all duration-300">
    </main>
<script>
    // Cargar menÃº segÃºn rol del usuario
    (function() {
        const userInfo = localStorage.getItem('user_info');
        if (!userInfo) {
            console.warn('No user info found');
            return;
        }
        
        try {
            const user = JSON.parse(userInfo);
            const menuContainer = document.getElementById('sidebar-menu');
            
            if (!menuContainer) {
                console.error('Sidebar menu container not found');
                return;
            }
            
            let menuHTML = '';
            
            if (user.rol === 'ADMIN') {
                menuHTML = `
                    <a href="/dashboard/admin/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ“Š</span>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    
                    <a href="/usuarios/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ‘¥</span>
                        <span class="font-medium">Usuarios</span>
                    </a>
                    
                    <a href="/charlas/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ“š</span>
                        <span class="font-medium">Charlas</span>
                    </a>
                    
                    <a href="/reportes/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ“„</span>
                        <span class="font-medium">Reportes</span>
                    </a>
                    
                    <a href="/accesos/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸšª</span>
                        <span class="font-medium">Control de Acceso</span>
                    </a>
                    
                    <hr class="my-4 border-gray-200">
                    
                    <a href="#" onclick="logout(); return false;" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-red-50 text-red-600 transition">
                        <span class="text-2xl">ðŸšª</span>
                        <span class="font-medium">Cerrar SesiÃ³n</span>
                    </a>
                `;
            } else if (user.rol === 'SUPERVISOR') {
                menuHTML = `
                    <a href="/dashboard/supervisor/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ“Š</span>
                        <span class="font-medium">Dashboard</span>
                    </a>
                    
                    <a href="/charlas/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ“š</span>
                        <span class="font-medium">Mis Charlas</span>
                    </a>
                    
                    <a href="/charlas/crear/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">âž•</span>
                        <span class="font-medium">Nueva Charla</span>
                    </a>
                    
                    <a href="/reportes/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸ“„</span>
                        <span class="font-medium">Reportes</span>
                    </a>
                    
                    <a href="/accesos/" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-blue-50 transition">
                        <span class="text-2xl">ðŸšª</span>
                        <span class="font-medium">Control de Acceso</span>
                    </a>
                    
                    <hr class="my-4 border-gray-200">
                    
                    <a href="#" onclick="logout(); return false;" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-red-50 text-red-600 transition">
                        <span class="text-2xl">ðŸšª</span>
                        <span class="font-medium">Cerrar SesiÃ³n</span>
                    </a>
                `;
            } else {
                // Trabajador - ocultar sidebar
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.style.display = 'none';
                }
                return;
            }
            
            menuContainer.innerHTML = menuHTML;
            console.log('Sidebar loaded successfully for role:', user.rol);
            
        } catch (e) {
            console.error('Error loading sidebar:', e);
        }
    })();
    // LÃ“GICA DE MINIMIZAR SIDEBAR
    // -----------------------------------------------------------------
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('main-content');
    const toggleButton = document.getElementById('sidebar-toggle');
    const toggleIcon = document.getElementById('toggle-icon');
    const toggleText = document.getElementById('toggle-text');
    const menuItems = document.getElementById('sidebar-menu');

    // Clases que definen el estado
    const SIDEBAR_MIN_CLASS = 'w-16';
    const SIDEBAR_MAX_CLASS = 'w-64';
    const CONTENT_MIN_CLASS = 'ml-16'; // Debe coincidir con el ancho mÃ­nimo
    const CONTENT_MAX_CLASS = 'ml-64'; // Debe coincidir con el ancho mÃ¡ximo
    const ICON_ROTATED_CLASS = 'rotate-180';
    
    // Clases para ocultar/mostrar texto en el sidebar
    const TEXT_VISIBLE_CLASS = 'flex';
    const TEXT_HIDDEN_CLASS = 'hidden';

    function toggleSidebar() {
        if (!sidebar || !mainContent) return;
        
        const isMinimized = sidebar.classList.contains(SIDEBAR_MIN_CLASS);
        
        // 1. Alternar clases del Sidebar (w-64 <-> w-16)
        sidebar.classList.toggle(SIDEBAR_MAX_CLASS);
        sidebar.classList.toggle(SIDEBAR_MIN_CLASS);
        
        // 2. Alternar margen del Contenido Principal (ml-64 <-> ml-16)
        mainContent.classList.toggle(CONTENT_MAX_CLASS);
        mainContent.classList.toggle(CONTENT_MIN_CLASS);
        
        // 3. Rotar Ã­cono y cambiar texto
        toggleIcon.classList.toggle(ICON_ROTATED_CLASS);
        toggleText.textContent = isMinimized ? 'Minimizar' : 'Expandir';
        
        // 4. Ocultar/Mostrar texto de los Ã­tems del menÃº (Ajuste visual)
        // Damos un pequeÃ±o delay para que la transiciÃ³n de ancho se vea bien.
        setTimeout(() => {
             // Esconder/Mostrar el texto del menÃº (span.font-medium)
             const textSpans = menuItems.querySelectorAll('span.font-medium');
             textSpans.forEach(span => {
                 span.classList.toggle(TEXT_HIDDEN_CLASS);
                 span.classList.toggle(TEXT_VISIBLE_CLASS);
             });
        }, isMinimized ? 300 : 100); // 300ms cuando se minimiza, 100ms cuando se expande
        
        // 5. Guardar estado en localStorage
        localStorage.setItem('sidebarMinimized', !isMinimized);
    }
    
    // FunciÃ³n para aplicar el estado al cargar la pÃ¡gina
    function applySidebarState() {
        const savedState = localStorage.getItem('sidebarMinimized') === 'true';
        
        // AsegÃºrate de que los elementos se encuentren antes de aplicar
        if (savedState && sidebar && mainContent) {
            
            // Si el estado guardado es minimizado, aplicamos las clases de minimizado
            // solo si el sidebar no estÃ¡ ya en el estado minimizado.
            if (!sidebar.classList.contains(SIDEBAR_MIN_CLASS)) {
                // Aplicar las clases opuestas a las bases para minimizar
                sidebar.classList.remove(SIDEBAR_MAX_CLASS);
                sidebar.classList.add(SIDEBAR_MIN_CLASS);
                
                mainContent.classList.remove(CONTENT_MAX_CLASS);
                mainContent.classList.add(CONTENT_MIN_CLASS);
                
                toggleIcon.classList.add(ICON_ROTATED_CLASS);
                toggleText.textContent = 'Expandir';
                
                // Ocultar texto al cargar
                const textSpans = menuItems.querySelectorAll('span.font-medium');
                textSpans.forEach(span => {
                     span.classList.remove(TEXT_VISIBLE_CLASS);
                     span.classList.add(TEXT_HIDDEN_CLASS);
                });
            }
        }
    }

    // Listener para el botÃ³n de alternar
    document.addEventListener('DOMContentLoaded', function() {
        if (toggleButton) {
            toggleButton.addEventListener('click', toggleSidebar);
        }
        
        // Aplicar el estado guardado al inicio (se ejecutarÃ¡ una vez que el DOM estÃ© listo)
        applySidebarState();
    });
</script>